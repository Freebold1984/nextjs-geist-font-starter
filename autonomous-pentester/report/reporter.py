from review.peer_review import peer_review

def generate_report(results=None):
    """
    Generate a report from the scan results.
    If results is None, generate the latest saved report.
    Includes peer review filtering and summary analytics.
    """
    if results:
        print(f"Generating report for target: {results['target']}")
        vulnerabilities = results['vulnerabilities']
        # Filter vulnerabilities through peer review
        reviewed_vulns = [v for v in vulnerabilities if peer_review(v)]
        for vuln in reviewed_vulns:
            print(f"- {vuln['type']} ({vuln['severity']}): {vuln['description']}")
        # Summary analytics
        severity_count = {}
        for v in reviewed_vulns:
            severity_count[v['severity']] = severity_count.get(v['severity'], 0) + 1
        print("Summary:")
        for severity, count in severity_count.items():
            print(f"  {severity}: {count}")
    else:
        print("No scan results provided. Generating latest saved report (not implemented).")
