from validator.validator import validate_vulnerability
from scanner.real_scanner import RealVulnerabilityScanner

def run_scan(target):
    """
    Real dynamic vulnerability scan on the target using RealVulnerabilityScanner.
    """
    print(f"Running real dynamic vulnerability scan on {target}...")

    scanner = RealVulnerabilityScanner(target)
    vulnerabilities = scanner.run()

    validated_vulns = []
    for vuln in vulnerabilities:
        if vuln["payload"]:
            is_valid = validate_vulnerability(target, vuln["payload"])
            if is_valid:
                validated_vulns.append(vuln)
        else:
            validated_vulns.append(vuln)

    results = {
        "target": target,
        "vulnerabilities": validated_vulns
    }
    return results
